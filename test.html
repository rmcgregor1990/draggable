<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>jQuery UI Draggable - Default functionality</title>
  <link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.10.4.custom.css">
  <script src="js/jquery-1.10.2.js"></script>
  <script src="js/jquery-ui-1.10.4.custom.js"></script>
  <script src="js/svg-input-elements.js"></script>
  <style>
      #draggable { width: 150px; height: 150px; padding: 0.5em; position: absolute;}
      #draggable2 { width: 150px; height: 150px; padding: 0.5em; position: absolute;}
  </style>
  <script>

    var bob = {'child': null, 'position': {'left':500, 'top':0 }};

    var snapParents;


function snapPosition(position, child) {
      var ret_pos = {'left':position.left, 'top':position.top};
      for (var i = snapParents.length - 1; i >= 0; i--) {
          if (snapParents[i].id !== child)
          {

              var pLeft = snapParents[i].id.position().left;
              var pTop = snapParents[i].id.position().top + 150;
              var dist = Math.sqrt(Math.pow((position.left-pLeft), 2) + Math.pow((position.top-pTop), 2));
              if (dist < 150) {
                ret_pos.left = pLeft;
                ret_pos.top = pTop;
                snapParents[i].id.data("child", child);
                child.data("wigetParent", snapParents[i].id);
                child.wigetParent = snapParents[i].id;
                break;
            }
            else
            {
                snapParents[i].id.data("child", null);
                child.data("wigetParent", null);
            }
          }
    };
    return ret_pos;
}


var onDrag =  function(event, ui) {
  var ret = snapPosition(ui.offset, $(this));
  console.log(ret.left - ui.offset.left);
  ui.position.left = ui.position.left + ret.left - ui.offset.left;
  ui.position.top = ui.position.top + ret.top - ui.offset.top;


};


var onDrag2 = function(event, ui) {
   if ($(this).data("child") !== undefined && $(this).data("child") !== null)
   {

    var ret_pos = {'left':ui.position.left, 'top':ui.position.top};
    ret_pos.top += 150;
    $(this).data("child").css(ret_pos);

}
};

var onEnd = function() {
      //$(this).offset({'top': 100, 'left': 100});
  };

  var checkRevert = function(event, ui) {
    if ($(this).data("wigetParent") === undefined || $(this).data("wigetParent") == null)
    {
        return true;
    }

    return false;
};


$(function() {
    snapParents = [{'id': $('#draggable2')}];
    $( "#draggable" ).draggable({drag: onDrag, stop: onEnd});
    $( "#draggable2" ).draggable({drag: onDrag2});

    $( "#temp2" ).droppable({
      activeClass: "ui-state-default",
      hoverClass: "ui-state-hover",
      drop: function( event, ui ) {
        $( this )
        .addClass( "ui-state-highlight" )
        .find( "p" )
        .html( "Dropped!" );

    }
});

});

</script>
</head>

<svg id="svg" version="1.1" width="600px" height="600px" xmlns="http://www.w3.org/2000/svg">
</svg>
<body>

  <script type="text/javascript">
    var svg = document.getElementById("svg")
    var textarea = SVGIE.textarea(svg, { width: 600 }, "hello");

</script>

<div id="draggable" class="draggable ui-widget-content">
  <svg>
      <circle cx="100" cy="100" r="50" stroke-width="1" stroke="#000" fill="#ccc" />
  </circle>
</svg>
<input type="text" id="123"></input>
</div>

<div id="draggable2" class="draggable ui-widget-content">
  <svg>
      <circle cx="100" cy="100" r="50" stroke-width="1" stroke="#000" fill="#ccc" />
  </circle>
</svg>
</div>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" id="temp2" preserveAspectRatio="xMidYMid meet">
  <title>Scalable Vector Graphics (SVG) Demo</title>
  <circle cx="100" cy="100" r="50" stroke-width="1" stroke="#000" fill="#ccc" />
  <rect id="temp" x="200" y="50" width="250" height="100" rx="5" ry="5"  stroke="#000" stroke-width="1" fill="#ccc" />
  <text x="78" y="100" font-family="helvetica, sans-serif" font-size="16" fill="#000">Circle</text>
  <text x="260" y="100" font-family="helvetica, sans-serif" font-size="16" fill="#000">Rounded Rectangle</text>
</svg>


</body>
</html>
